# =============================================================================
# Production Overrides
# =============================================================================
# Use this file for production deployments with managed PostgreSQL.
#
# Deploy with:
#   docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d
#
# This file:
# - Uses pre-built images from GitHub Container Registry
# - Removes the local PostgreSQL container (use managed DB instead)
# - Configures services to use external DATABASE_URL
# =============================================================================

services:
  # Disable the local PostgreSQL container in production
  # Use DigitalOcean Managed PostgreSQL instead
  postgres:
    profiles:
      - disabled  # This prevents the container from starting

  # Update test-service for production - use pre-built image
  test-service:
    image: ghcr.io/cforrester-hub/test-service:latest
    environment:
      # DATABASE_URL from .env points to managed PostgreSQL
      DATABASE_URL: ${DATABASE_URL}
      REDIS_URL: redis://redis:6379/0
      LOKI_URL: http://loki:3100
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
    logging:
      driver: json-file  # Use default logging in prod (Loki requires extra setup)

  # Update ringcentral-service for production - use pre-built image
  ringcentral-service:
    image: ghcr.io/cforrester-hub/ringcentral-service:latest
    environment:
      RINGCENTRAL_CLIENT_ID: ${RINGCENTRAL_CLIENT_ID}
      RINGCENTRAL_CLIENT_SECRET: ${RINGCENTRAL_CLIENT_SECRET}
      RINGCENTRAL_JWT_TOKEN: ${RINGCENTRAL_JWT_TOKEN}
      RINGCENTRAL_SERVER_URL: ${RINGCENTRAL_SERVER_URL:-https://platform.ringcentral.com}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
    logging:
      driver: json-file
